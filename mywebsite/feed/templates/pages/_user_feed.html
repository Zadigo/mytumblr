{% extends "base_interface.html" %}
{% load i18n humanize cache %}

{% block title %}{{ user_feed.username }} - My Website{% endblock %}

{% block middle_header %}
    <div class="card">
        <div class="profile-banner">
            <div class="card-body">
                <div class="row">
                    <div class="col-4">
                        <div class="avatar">
                            {% with temp_url="https://images.unsplash.com/photo-1599231666334-ca0dbd7ad2da?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=500&q=80" %}
                                <img src="{{ user_feed.avatar|default:temp_url }}" class="img-fluid" alt="{{ user_feed.username }}" title="{{ user_feed.username }}">
                            {% endwith %}
                        </div>
                    </div>
    
                    <div class="col-8">
                        <h2>{{ user_feed.username }}</h2>
                        
                        {% cache 7200 user_statistics user_feed.username  %}
                            <div class="details d-flex flex-direction-row justify-content-left">
                                <p class="font-weight-bolder" id="follows">
                                    {{ user_feed.myuserprofile.follows.count|default:0 }} <span class="text-muted font-weight-light">follows</span>
                                </p>
        
                                <p class="ml-4 font-weight-bolder" id="followers">
                                    {{ user_feed.myuserprofile.followed_by.count|default:0 }} <span class="text-muted font-weight-light">followers</span>
                                </p>

                                <p class="ml-4 font-weight-bolder" id="likes">
                                    {{ likes.like__count|default:0 }} <span class="text-muted font-weight-light">likes</span>
                                </p>
                            </div>                            
                        {% endcache %}
            
                        <p>    
                            {% if user.username != user_feed.username %}
                                {% if user.myuserprofile in user_feed.myuserprofile.followed_by.all %}
                                    <a href="{% url 'feed:unfollow' user_feed.username %}" class="btn btn-sm btn-danger">
                                        {% trans "Unfollow user" %}
                                    </a>                                            
                                {% else %}
                                    <a href="{% url 'feed:follow' user_feed.username %}" class="btn btn-sm btn-primary">
                                        {% trans "Follow user" %}
                                    </a>                    
                                {% endif %}
                            {% else %}
                                <a href="{% url 'accounts:profile:home' %}" class="btn btn-sm btn-outline-primary">
                                    {% trans "Editer le profil" %}
                                </a>
                            {% endif %}
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block middle %}
    {% cache 120 userfeed user.username %}
        <div class="row">
            <div class="col-12">
                <div class="row">
                    {% for video in user_feed.video_set.all %}
                        {% include "components/cards/video/simple.html" %}
                    {% endfor %}
                </div>
            </div>
        </div>        
    {% endcache %}
{% endblock %}

{% block right %}
    <div class="row">
        <div class="col-12">
            <form action="{% url 'feed:search' %}" method="get">
                <div class="form-group">
                    <input class="form-control" type="search" name="q" id="search">
                </div>
            </form>
        </div>
    </div>
{% endblock %}
